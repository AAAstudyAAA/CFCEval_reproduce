from cgi import escape
from five import grok
from Products.CMFPlone.utils import base_hasattr
from Products.CMFPlone.utils import safe_unicode


try:
    from plone.formwidget.masterselect.interfaces import IMasterSelectWidget
    from plone.formwidget.masterselect.widget import MasterSelect as BaseMasterSelect
    class MasterSelect(BaseMasterSelect):
        grok.implements(IMasterSelectWidget)
        def getSlaves(self):
            for slave in self.field.slave_fields:
                yield slave.copy()
except ImportError:
    class MasterSelect(object):
        pass

try:
    from plone.formwidget.masterselect.widget import MasterSelect as BaseMasterSelect
    from plone.formwidget.masterselect.interfaces import IMasterSelectWidget
    class MasterSelect(BaseMasterSelect):
        grok.implements(IMasterSelectWidget)
        def getSlaves(self):
            for slave in self.field.slave_fields:
                yield slave.copy()
except ImportError:
    class MasterSelect(object):
        pass


@property
def title(self):
    if base_hasattr(self.context, 'get_full_title'):
        title = self.context.get_full_title()
    else:
        title = self.context.Title()
    title = title and safe_unicode(title) or u""
# co
    return escape(title)
# co