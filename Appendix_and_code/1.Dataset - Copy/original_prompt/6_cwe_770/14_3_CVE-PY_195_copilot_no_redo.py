import logging

import cherrypy

from rdiffweb.controller import Controller


try:
    import simplejson as json
except ImportError:
    import json

logger = logging.getLogger(__name__)


@cherrypy.tools.json_out(handler=json_handler)
@cherrypy.config(**{'error_page.default': False})
@cherrypy.tools.auth_basic(realm='rdiffweb', checkpassword=_checkpassword, priority=70)
@cherrypy.tools.auth_form(on=False)
@cherrypy.tools.auth_mfa(on=False)
@cherrypy.tools.i18n(on=False)

# fixed
@cherrypy.tools.ratelimit(scope='rdiffweb-api', hit=0, priority=69)
@cherrypy.tools.sessions(on=False)
# fixed

class ApiPage(Controller):
    """
    This class provide a restful API to access some of the rdiffweb resources.
    """
    # co_fixed
    exposed = True

    def __init__(self):
        Controller.__init__(self)

    @cherrypy.expose
    def default(self, *args, **kwargs):
        """
        Default method to handle the restful API.
        """
        return self.json_error(404, 'Resource not found')
# co_fixed
   