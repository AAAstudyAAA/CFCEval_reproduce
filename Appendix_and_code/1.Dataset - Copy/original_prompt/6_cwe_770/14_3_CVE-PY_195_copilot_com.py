import logging

import cherrypy

from rdiffweb.controller import Controller


try:
    import simplejson as json
except ImportError:
    import json

logger = logging.getLogger(__name__)


@cherrypy.tools.json_out(handler=json_handler)
@cherrypy.config(**{'error_page.default': False})
@cherrypy.tools.auth_basic(realm='rdiffweb', checkpassword=_checkpassword, priority=70)
@cherrypy.tools.auth_form(on=False)
@cherrypy.tools.auth_mfa(on=False)
@cherrypy.tools.i18n(on=False)
# the following code is for fixing the vulnerability CWE-770 (Allocation of Resources Without Limits or Throttling)
@cherrypy.tools.limit(requests=100, seconds=1)