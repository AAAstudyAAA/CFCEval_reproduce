import logging

from rdiffweb.controller.cherrypy_wtf import CherryForm
from rdiffweb.core.store import ADMIN_ROLE, MAINTAINER_ROLE, USER_ROLE
from rdiffweb.tools.i18n import ugettext as _
from wtforms import validators
from wtforms.fields import PasswordField, SelectField, StringField
from wtforms.fields.html5 import EmailField

# Define the logger
logger = logging.getLogger(__name__)


class UserForm(CherryForm):
    userid = StringField(_('UserID'))
    username = StringField(_('Username'), validators=[validators.data_required()])
    email = EmailField(_('Email'), validators=[validators.optional()])
# vulnerable
    password = PasswordField(_('Password'))
# vulnerable
    user_root = StringField(
        _('Root directory'), description=_("Absolute path defining the location of the repositories for this user.")
    )
    role = SelectField(
        _('User Role'),
        coerce=int,
        choices=[(ADMIN_ROLE, _("Admin")), (MAINTAINER_ROLE, _("Maintainer")), (USER_ROLE, _("User"))],
        default=USER_ROLE,
        description=_(
            "Admin: may browse and delete everything. Maintainer: may browse and delete their own repo. User: may only browser their own repo."
        ),
    )
    disk_quota = SizeField(
        _('Disk space'),
        validators=[validators.optional()],
        description=_("Users disk spaces (in bytes). Set to 0 to remove quota (unlimited)."),
    )
    disk_usage = SizeField(
        _('Quota Used'), validators=[validators.optional()], description=_("Disk spaces (in bytes) used by this user.")
    )