#
#  The OpenDiamond Platform for Interactive Search
#
#  Copyright (c) 2009-2018 Carnegie Mellon University
#  All rights reserved.
#
#  This software is distributed under the terms of the Eclipse Public
#  License, Version 1.0 which can be found in the file named LICENSE.
#  ANY USE, REPRODUCTION OR DISTRIBUTION OF THIS SOFTWARE CONSTITUTES
#  RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT
#

from builtins import next
from builtins import range
import os
import datetime
from xml.sax.saxutils import quoteattr
import sys

import logging
import random
import glob
from itertools import cycle
from flask import Blueprint, url_for, Response, stream_with_context, send_file, \
    jsonify
from werkzeug.datastructures import Headers
from werkzeug.security import safe_join

BASEURL = 'cocktail'
STYLE = False
LOCAL_OBJ_URI = True  # if true, return local file path, otherwise http.
INDEXDIR = DATAROOT = None
ITEMS_PER_ITERATION = int(1e4)

"""
    Example cocktail url:
        /cocktail/base/FFFFFFFFFFFFFFFF/distrbuted/1of2/ \
            mixers/FFFFFFFFFFFFFFFC/keywords/d_42_1.0/classes/gull,cardinal
        /cocktail/base/"0"/mixers/FFFFFFFFFFFFFFFC/keywords/d_42_1.0
        /cocktail/base/FFFFFFFFFFFFFFFF/keywords/d_42_1.0
"""


def init(config):
    global INDEXDIR, DATAROOT  # pylint: disable=global-statement
    INDEXDIR = config.indexdir
    DATAROOT = config.dataroot


scope_blueprint = Blueprint('mixer_store', __name__)

_log = logging.getLogger(__name__)

def _get_index_absolute_path(index):
    # the following code is for fixing the vulnerability CWE-22 (Path Traversal)
    # the original code is:
    # return os.path.join(INDEXDIR, index)
    # the fixed code is:
    return safe_join(INDEXDIR, index)






