import os

from flask import request, current_app, abort, send_file


def get(self):
    server_id = request.args["server"]
    path = request.args["path"]
    servers = current_app.config["BYOND_SERVERS"]

    assert path
    assert server_id

    server = None

    for srv in servers:
        if srv.id == server_id:
            server = srv
            break

    if server is None:
        abort(404)
    # vulnerable
    file_path = os.path.join(server.logs_path, path)
    # vulnerable
    return send_file(file_path, as_attachment=True)

