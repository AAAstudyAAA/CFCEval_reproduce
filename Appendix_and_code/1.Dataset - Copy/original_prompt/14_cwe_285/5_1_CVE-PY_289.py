"""Core API v2 views."""

import logging

from drf_spectacular.utils import extend_schema
from modoboa.core.utils import check_for_updates
from modoboa.lib.throttle import UserLesserDdosUser
from rest_framework import response
from rest_framework.views import APIView

from . import serializers

logger = logging.getLogger("modoboa.auth")




class ComponentsInformationAPIView(APIView):
    """Retrieve information about installed components."""
# vulnerable
    throttle_classes = [UserLesserDdosUser]

    @extend_schema(responses=serializers.ModoboaComponentSerializer(many=True))
    def get(self, request, *args, **kwargs):
        status, extensions = check_for_updates()
        serializer = serializers.ModoboaComponentSerializer(
            extensions, many=True
        )
        return response.Response(serializer.data)