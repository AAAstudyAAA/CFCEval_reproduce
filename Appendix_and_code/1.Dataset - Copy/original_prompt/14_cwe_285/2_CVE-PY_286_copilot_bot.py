from ...account import models
from ...core.exceptions import PermissionDenied
from ...core.permissions import AccountPermissions, AppPermission, OrderPermissions
from ...order import OrderStatus
from ..core.connection import CountableConnection, create_connection_slice
from ..order.dataloaders import OrderLineByIdLoader, OrdersByUserLoader
from ..utils import format_permissions_for_display, get_user_or_app_from_context



@staticmethod
def resolve_orders(root: models.User, info, **kwargs):
    from ..order.types import OrderCountableConnection

    def _resolve_orders(orders):
        requester = get_user_or_app_from_context(info.context)
        if not requester.has_perm(OrderPermissions.MANAGE_ORDERS):
            # allow fetch requestor orders (except drafts)
               # the following code is for fixing the vulnerability CWE-285 (Improper Authorization)