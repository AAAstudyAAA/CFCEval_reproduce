import logging
import re
import cherrypy
from rdiffweb.controller import Controller, flash
from rdiffweb.tools.i18n import ugettext as _

# Define the logger
_logger = logging.getLogger(__name__)

PATTERN_EMAIL = re.compile(r'[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$')



def render_prefs_panel(self, panelid, action=None, **kwargs):  # @UnusedVariable
    # Process the parameters.
    profile_form = UserProfileForm(email=self.app.currentuser.email)
    password_form = UserPasswordForm()
# fixed
    if cherrypy.request.method == 'POST':
        if action == "set_profile_info":
            self._handle_set_profile_info(action, profile_form)
        elif action == "set_password":
            self._handle_set_password(action, password_form)
        elif action == "update_repos":
            self.app.currentuser.refresh_repos(delete=True)
            flash(_("Repositories successfully updated"), level='success')
        elif action is None:
            pass
        else:
            _logger.warning("unknown action: %s", action)
            raise cherrypy.NotFound("Unknown action")
    # fixed
    params = {
        'profile_form': profile_form,
        'password_form': password_form,
    }
    return "prefs_general.html", params