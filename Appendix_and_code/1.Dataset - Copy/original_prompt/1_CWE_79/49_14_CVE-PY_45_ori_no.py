import os
import sys
try:
    import pwd
except ImportError:
    pwd = None  # type: ignore[assignment]
from twisted.web import http, resource, server, static, util


def getChild(self, name, request):
    if name == b"":
        return self

    td = b".twistd"

    if name.endswith(td):
        username = name[: -len(td)]
        sub = 1
    else:
        username = name
        sub = 0
    try:
        # Decode using the filesystem encoding to reverse a transformation
        # done in the pwd module.
        (
            pw_name,
            pw_passwd,
            pw_uid,
            pw_gid,
            pw_gecos,
            pw_dir,
            pw_shell,
        ) = self._pwd.getpwnam(username.decode(sys.getfilesystemencoding()))
    except KeyError:
        return resource._UnsafeNoResource()
    if sub:
        twistdsock = os.path.join(pw_dir, self.userSocketName)
        rs = ResourceSubscription("unix", twistdsock)
        self.putChild(name, rs)
        return rs
    else:
        path = os.path.join(pw_dir, self.userDirName)
        if not os.path.exists(path):
