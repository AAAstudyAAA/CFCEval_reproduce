from django.shortcuts import render, redirect, get_object_or_404
from spirit.core.utils.decorators import moderator_required
from spirit.core.utils.views import is_post

from .models import Comment


@moderator_required
def delete(request, pk, remove=True):
    comment = get_object_or_404(Comment, pk=pk)
    if is_post(request):
        (Comment.objects
         .filter(pk=pk)
         .update(is_removed=remove))
#vulnerable
        return redirect(request.GET.get('next', comment.get_absolute_url()))
#vulnerable
    return render(
        request=request,
        template_name='spirit/comment/moderate.html',
        context={'comment': comment})
