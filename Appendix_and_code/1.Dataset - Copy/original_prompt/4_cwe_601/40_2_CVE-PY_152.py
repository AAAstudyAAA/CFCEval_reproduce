#!/bin/python
# -*- coding: utf-8 -*-

"""
| This file is part of the web2py Web Framework
| Copyrighted by Massimo Di Pierro <mdipierro@cs.depaul.edu>
| License: LGPLv3 (http://www.gnu.org/licenses/lgpl.html)

Auth, Mail, PluginManager and various utilities
------------------------------------------------
"""

import logging

from gluon import *

Table = DAL.Table
Field = DAL.Field

__all__ = ['Mail', 'Auth', 'Recaptcha2', 'Crud', 'Service', 'Wiki',
           'PluginManager', 'fetch', 'geocode', 'reverse_geocode', 'prettydate']

# mind there are two loggers here (logger and crud.settings.logger)!
logger = logging.getLogger("web2py")

DEFAULT = lambda: None


def get_vars_next(self):
    next = current.request.vars._next
    host = current.request.env.http_host
    if isinstance(next, (list, tuple)):
        next = next[0]
    if next and self.settings.prevent_open_redirect_attacks:
        # vulnerable
        return self.prevent_open_redirect(next, host)
    # vulnerable
    return next or None