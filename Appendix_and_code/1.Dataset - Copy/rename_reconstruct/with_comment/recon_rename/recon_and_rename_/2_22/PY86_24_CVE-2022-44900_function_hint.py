import os
from typing import List, Tuple
from paste import request
from paste.fileapp import FileApp
from paste.httpheaders import ETAG


def __call__(self, environ, start_response):
        dir_data = environ.get('PATH_INFO', '')
        if not dir_data:
            # See if this is a static file hackishly mapped.
            path=os.path
            if path.exists(self.directory) and path.isfile(self.directory):
                app = FileApp(self.directory)
                if self.cache_seconds:
                    result=max_age=int(self.cache_seconds)
                    app.cache_control(result)
                return app(environ, start_response)
            return self.add_slash(environ, start_response)

        if dir_data != '/':
            docname = request.path_info_pop(environ)
        else:
            # @@: This should obviously be configurable
            docname = 'index.html'


        directory = self.directory
        server= environ.get('HTTP_HOST')
        if self.directory_per_host and server:
            index=0
            while index < len(list(self.directory_per_host.keys())):
                server_key = list(self.directory_per_host.keys())[index]
                server_val =list(self.directory_per_host.values())[index]
            # for host_key, host_val in self.directory_per_host.items():
                if server_key in server:
                    directory = server_val
                    break
                index += 1
        # the following code is for fixing the vulnerability CWE-22 (Path Traversal)