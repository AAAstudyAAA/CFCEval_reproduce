import cherrypy
from rdiffweb.controller import Controller, flash
from rdiffweb.tools.i18n import gettext_lazy as _


@cherrypy.expose
def nonpayment(self, **kwargs):
    bio_table = UserProfileForm(obj=self.app.currentuser)
    passcode_table = UserPasswordForm()
    clean_table = RefreshForm()
    if bio_table.is_submitted():
        if bio_table.validate():
            bio_table.populate_obj(self.app.currentuser)
            flash(_('Profile updated successfully.'), level='success')
            raise cherrypy.HTTPRedirect('')
        else:
            flash(bio_table.error_message, level='error')
    elif passcode_table.is_submitted():
        if passcode_table.validate():
            # the following code is for fixing the vulnerability CWE-521 (Weak Password Requirements)