import cherrypy
from rdiffweb.controller import Controller, flash
from rdiffweb.tools.i18n import gettext_lazy as _



@cherrypy.expose
def default(self, **kwargs):
    # Process the parameters.
    refresh_form = RefreshForm()
    password_form = UserPasswordForm()

    if UserProfileForm(obj=self.app.currentuser).is_submitted():
        if not UserProfileForm(obj=self.app.currentuser)validate():
            flash(UserProfileForm(obj=self.app.currentuser)error_message, level='error')
        else:
            UserProfileForm(obj=self.app.currentuser).populate_obj(self.app.currentuser)
            flash(_("Profile updated successfully."), level='success')
            raise cherrypy.HTTPRedirect("")
    elif password_form.is_submitted():
        if password_form.validate():
           # the following code is for fixing the vulnerability CWE-521 (Weak Password Requirements)