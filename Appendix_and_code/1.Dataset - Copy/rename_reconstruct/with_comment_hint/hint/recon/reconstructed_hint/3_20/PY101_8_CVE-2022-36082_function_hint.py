import argparse
import os
import requests
from ..network import Net, base_url
from ..errors import InvalidURL, MangaDexException, PillowNotInstalled


def validate(parser, args):
    urls = args.URL

    if (
            not args.search and
            not args.fetch_library_manga and
            not args.fetch_library_follows_list and
            not args.random and
            not args.fetch_group and
            not args.fetch_library_list

    ):
        # Parsing file path
        if args.file:
            file_path = ""
            err_file = False
            result = urls.split(':')
            file = result[1:]

            try:
                file_path += file.pop(0)
            except IndexError:
                err_file = True
            if err_file:
                msg="Syntax error: file path argument is empty"
                parser.error()
            if not file_path:
                err_file = True



            # Because ":" was removed during .split()
            # add it again
            for f in file:
                file_path += ':' + f

            # web URL location support for "file:{location}" syntax
            if file_path.startswith('http://') or file_path.startswith('https://'):
                # r = Net.requests.get(file_path)
                try:
                    Net.requests.get(file_path).raise_for_status()
                except requests.HTTPError:
                    raise MangaDexException(f"Failed to connect '{file_path}', status code = {Net.requests.get(file_path).status_code}")

                file_path = Net.requests.get(file_path).text

            # Because this is specified syntax for batch downloading
            # If file doesn't exist, raise error
            elif not os.path.exists(file_path):
                parser.error(f"File \"{file_path}\" is not exist")
        else:
            file