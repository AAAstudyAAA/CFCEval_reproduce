from django.contrib.auth import (
    forms as auth_forms, get_user_model, password_validation
)
from django.utils.translation import ugettext as _, ugettext_lazy


def clean(self):
    super().clean()
    if self.errors:
        return self.cleaned_data
    confirmation = self.cleaned_data.get("confirmation")
    oldpassword = self.cleaned_data.get("oldpassword")
    newpassword = self.cleaned_data.get("newpassword")

    if newpassword and confirmation:
        if oldpassword:
            if newpassword==confirmation:
                password_validation.validate_password(
                    self.cleaned_data.get("confirmation"), self.instance)
            else:
                self.add_error("confirmation", _("Passwords mismatch"))
        else:
            self.add_error("oldpassword", _("This field is required."))

    elif 