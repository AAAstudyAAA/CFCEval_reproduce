import argparse
import os
import requests
from ..network import Net, base_url
from ..errors import InvalidURL, MangaDexException, PillowNotInstalled


def formalize(parser, args):
    links = args.URL
    if (
            not args.search and
            not args.fetch_library_manga and
            not args.fetch_library_list and
            not args.fetch_library_follows_list and
            not args.random and not args.fetch_group):
        if args.file:
            outcome = links.split(':')
            doc = outcome[1:]
            doc_dir = ''
            err_doc = False
            try:
                doc_dir += doc.pop(0)
            except IndexError:
                err_doc = True
            if not doc_dir:
                err_doc = True
            if err_doc:
                parser.error('Syntax error: file path argument is empty')
            for f in doc:
                doc_dir += ':' + f
            if doc_dir.startswith('http://') or doc_dir.startswith('https://'):
                r = Net.requests.get(doc_dir)
                try:
                    r.raise_for_status()
                except requests.HTTPError:
                    raise MangaDexException(
                        f"Failed to connect '{doc_dir}', status code = {r.status_code}")
                doc_dir = r.text
            elif not os.path.exists(doc_dir):
                parser.error(f'File "{doc_dir}" is not exist')
        else:
            doc_body