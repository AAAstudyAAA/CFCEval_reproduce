from django.contrib.auth import (
    forms as auth_forms, get_user_model, password_validation
)
from django.utils.translation import ugettext as _, ugettext_lazy


def clean(self):
    super().clean()
    if self.errors:
        return self.cleaned_data
    check = self.cleaned_data.get("confirmation")
    old_code= self.cleaned_data.get("oldpassword")
    new_code = self.cleaned_data.get("newpassword")

    if new_code and check:
        if old_code:
            if new_code==check:
                password_validation.validate_password(
                    self.cleaned_data.get("confirmation"), self.instance)
            else:
                self.add_error("confirmation", _("Passwords mismatch"))
        else:
            self.add_error("oldpassword", _("This field is required."))

    elif