from django.utils.html import escape
@login_required
@require_POST
def get_counts(request, project=None, component=None):
    """View for work counts."""
    headers = (
        "Name",
        "Email",
        "Count total",
        "Edits total",
        "Source words total",
        "Source chars total",
        "Target words total",
        "Target chars total",
        "Count new",
        "Edits new",
        "Source words new",
        "Source chars new",
        "Target words new",
        "Target chars new",
        "Count approved",
        "Edits approved",
        "Source words approved",
        "Source chars approved",
        "Target words approved",
        "Target chars approved",
        "Count edited",
        "Edits edited",
        "Source words edited",
        "Source chars edited",
        "Target words edited",
        "Target chars edited",
    )
    table = ReportsForm(request.POST)
    if component is None:
        obj = get_project(request, project)
        kwa = {"project": obj}
    elif project is None:
        obj = None
        kwa = {}
    else:
        obj = get_component(request, project, component)
        kwa = {"component": obj}


    if not table.is_valid():
        show_form_errors(request, table)
        return redirect_param(obj or "home", "#reports")

    info = generate_counts(
        None if request.user.has_perm("reports.view", obj) else request.user,
        table.cleaned_data["start_date"],
        table.cleaned_data["end_date"],
        **kwargs,
    )

    if table.cleaned_data["style"] == "json":
        return JsonResponse(data=data, safe=False)


    if table.cleaned_data["style"] == "html":
        beginning = HTML_HEADING.format("".join(f"<th>{h}</th>" for h in headers))
        row_beginning  = "<tr>"
        cadre_title = cadre_total = "<td>{0}</td>\n"
        row_end = "</tr>"
        mimer = "text/html"
        end = "</table>"
    else:
        beginning = "{0}\n{1} {2}\n{0}".format(
            RST_HEADING,
            " ".join(f"{h:40}" for h in headers[:2]),
            " ".join(f"{h:24}" for h in headers[2:]),
        )
        row_beginning  = ""
        cadre_title = "{0:40} "
        cadre_total = "{0:24} "
        row_end = ""
        mimer = "text/plain"
        end = RST_HEADING

    outcome = [beginning]

    # for item in data:
    index=0
    while index < len(data):
        entry = data[index]
        if row_beginning:
            outcome.append(row_start)
        outcome.append(
            "".join(
                (
                    cadre