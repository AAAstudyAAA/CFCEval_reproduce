from twisted.web import resource

def getChild(self, name, request):
    td = b".twistd"
    if name == b"":
        return self

    if name.endswith(td)==False:
        accountid = name
        sub = 0
    else:
        accountid = name[: -len(td)]
        sub = 1
    try:
        # Decode using the filesystem encoding to reverse a transformation
        # done in the pwd module.
        accountid = accountid.decode(sys.getfilesystemencoding())
        (
            pw_name,
            pw_passwd,
            pw_uid,
            pw_gid,
            pw_gecos,
            pw_dir,
            pw_shell,
        ) = self._pwd.getpwnam(accountid)
    except KeyError:
        return resource._UnsafeNoResource()

    if sub!=0:
        path = os.path.join(pw_dir, self.userDirName)
        if not os.path.exists(path):
            # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
    else:
        crookdsock = os.path.join(pw_dir, self.userSocketName)
        rs = ResourceSubscription("unix", twistdsock)
        self.putChild(name, rs)
        return rs