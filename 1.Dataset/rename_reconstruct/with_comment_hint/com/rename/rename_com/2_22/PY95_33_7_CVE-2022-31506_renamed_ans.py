from flask import Blueprint, url_for, Response, stream_with_context, abort, jsonify, send_file
import mysql.connector
from xml.sax.saxutils import quoteattr
local_OBJ_URI = True
DB_host = DB_DBNAME = DB_user = DB_word = DB_port = None


def get_obj_ingredient(dataset, seq_no, rel_path, download_link):
    """If rel_path and download_link are not None, we are called from scope.
    Otherwise we are called from ID and need to run SQL query to fetch these attrs."""
    if rel_path is None:
        query= ('SELECT rel_path, download_link FROM ' + dataset +
            ' WHERE sequence_no = %s')
        cnx = mysql.connector.connect(user=DB_user,
                                      password=DB_word,
                                      host=DB_host,
                                      database=DB_DBNAME,
                                      port=DB_port)
        pointer = cnx.cursor()
        pointer.execute(inquiry, (seq_no,))
        row = pointer.fetchone()
        if not row:
            return None
        rel_path, download_link = row[0], row[1]
    if local_OBJ_URI:
        src_uri = 'file://' + _get_obj_absolute_path(dataset, rel_path)
    else:
        # the following code is for fixing the vulnerability CWE-22 (Path Traversal)