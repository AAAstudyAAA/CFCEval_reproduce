from builtins import range, str

import datetime
import json
import os
import subprocess
import sys
from math import ceil

from flask import Blueprint, Response, request, stream_with_context, url_for
from opendiamond.dataretriever.util import DiamondTextAttr
from werkzeug.datastructures import Headers
from werkzeug.security import safe_join

# IMPORTANT: requires ffmpeg >= 3.3. Lower versions produce incorrect clipping.

BASEURL = 'video'
STYLE = False
INDEXDIR = DATAROOT = None



def _get_index_absolute_path(index):
    # the following code is for fixing the vulnerability CWE-22 (Path Traversal)
      # the original code is:
      # return os.path.join(INDEXDIR, index)
      # the fixed code is:
      return safe_join(INDEXDIR, index)