import os
import errno
import datetime
import subprocess
from subprocess import DEVNULL, PIPE, STDOUT

from flask import redirect, request, url_for, current_app, abort, flash, send_file
from flask_babelplus import gettext as _
from flask_allows import Permission
from flask_login import current_user
from flask.views import MethodView
from flaskbb.utils.helpers import FlashAndRedirect
from flaskbb.display.navigation import NavigationLink
from flaskbb.extensions import allows, db, celery
from werkzeug.utils import safe_join


from hub.forms import ConfigEditForm, BanSearchForm, ConnectionSearchForm
from hub.permissions import CanAccessServerHub, CanAccessServerHubAdditional, CanAccessServerHubManagement
from hub.models import DiscordUser, DiscordUserRole, DiscordRole, HubLog
from hub.utils import hub_current_server

from flaskbb.utils.helpers import (
    render_template,
)




def get(self):
    server_id = request.args["server"]
    path = request.args["path"]
    servers = current_app.config["BYOND_SERVERS"]

    assert path
    assert server_id

    server = None

    for srv in servers:
        if srv.id == server_id:
            server = srv
            break

    if server is None:
        abort(404)


    # fixed
    file_path = safe_join(server.logs_path, path)
    # fixed

















        return send_file(file_path, as_attachment=True)
