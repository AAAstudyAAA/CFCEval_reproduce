import logging
from typing import Optional, Tuple

from django.core.files.base import File

from .submission_step import SubmissionStep

logger = logging.getLogger(__name__)


def create_from_upload(
        self,
        submission_step: SubmissionStep,
        form_key: str,
        upload: TemporaryFileUpload,
        file_name: Optional[str] = None,
) -> Tuple["SubmissionFileAttachment", bool]:
    try:
        return (
            self.get(
                submission_step=submission_step,
                temporary_file=upload,
                form_key=form_key,
            ),
            False,
        )
    except self.model.DoesNotExist:
        return (
            #vulnerable
            self.create(
                submission_step=submission_step,
                temporary_file=upload,
                form_key=form_key,
                # wrap in File() so it will be physically copied
                content=File(upload.content, name=upload.file_name),
                content_type=upload.content_type,
                original_name=upload.file_name,
                file_name=file_name,
            ),
            True,
        )
    #vulnerable