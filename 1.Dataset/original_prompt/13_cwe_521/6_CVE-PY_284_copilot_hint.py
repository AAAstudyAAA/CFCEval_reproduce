"""Core forms."""


from django.contrib.auth import (
    forms as auth_forms, get_user_model, password_validation
)
from django.utils.translation import ugettext as _, ugettext_lazy

def clean(self):
    super().clean()
    if self.errors:
        return self.cleaned_data
    oldpassword = self.cleaned_data.get("oldpassword")
    newpassword = self.cleaned_data.get("newpassword")
    confirmation = self.cleaned_data.get("confirmation")
    if newpassword and confirmation:
        if oldpassword:
            if newpassword != confirmation:
                self.add_error("confirmation", _("Passwords mismatch"))
            else:
                password_validation.validate_password(
                    confirmation, self.instance)
        else:
            self.add_error("oldpassword", _("This field is required."))
    elif  newpassword or confirmation:
        self.add_error("confirmation", _("This field is required."))    