import logging
import re
import cherrypy
from rdiffweb.controller import Controller, flash
from rdiffweb.tools.i18n import ugettext as _

# Define the logger
_logger = logging.getLogger(__name__)

PATTERN_EMAIL = re.compile(r'[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$')



def render_prefs_panel(self, panelid, action=None, **kwargs):  # @UnusedVariable
    # Process the parameters.
    profile_form = UserProfileForm(email=self.app.currentuser.email)
    password_form = UserPasswordForm()
# co-fixed
    # If the user has submitted the form, process it.
    if cherrypy.request.method == 'POST':
        if action == 'profile':
            if profile_form.validate(cherrypy.request.params):
                self.app.currentuser.email = profile_form.email.data
                flash(_('Profile updated'), 'success')
            else:
                flash(_('Please correct the errors below'), 'error')
        elif action == 'password':
            if password_form.validate(cherrypy.request.params):
                self.app.currentuser.password = password_form.password.data
                flash(_('Password updated'), 'success')
            else:
                flash(_('Please correct the errors below'), 'error')

    #co-fixed
