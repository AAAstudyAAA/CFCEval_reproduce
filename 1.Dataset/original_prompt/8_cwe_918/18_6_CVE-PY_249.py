import requests
from requests.auth import HTTPBasicAuth


@staticmethod
def get_share_link(recipe):
    url = recipe.storage.url + '/ocs/v2.php/apps/files_sharing/api/v1/shares?format=json&path=' + recipe.file_path  # noqa: E501

    headers = {
        "OCS-APIRequest": "true",
        "Content-Type": "application/json"
    }

# vulnerable
    r = requests.get(
        url,
        headers=headers,
        auth=HTTPBasicAuth(
            recipe.storage.username, recipe.storage.password
        )
    )
# vulnerable
    response_json = r.json()
    for element in response_json['ocs']['data']:
        if element['share_type'] == '3':
            return element['url']

    return Nextcloud.create_share_link(recipe)
