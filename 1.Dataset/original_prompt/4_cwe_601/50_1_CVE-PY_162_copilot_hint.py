from urllib.parse import urlparse

# pylint: disable=E1120,R0901,R0904
from django.contrib.auth.models import User
from django.db import IntegrityError

from .forms import UserTermsAndConditionsModelForm, EmailTermsForm
from .models import TermsAndConditions, UserTermsAndConditions
from django.conf import settings
from django.core.mail import send_mail
from django.contrib import messages
from django.http import HttpResponseRedirect, Http404
from django.utils.translation import gettext as _
from django.views.generic import DetailView, CreateView, FormView
from django.template.loader import get_template
from django.utils.encoding import iri_to_uri
import logging
from smtplib import SMTPException

LOGGER = logging.getLogger(name="termsandconditions")
DEFAULT_TERMS_BASE_TEMPLATE = "base.html"
DEFAULT_TERMS_IP_HEADER_NAME = "REMOTE_ADDR"


def get_initial(self):
    """Override of CreateView method, queries for which T&C to accept and catches returnTo from URL"""
    LOGGER.debug("termsandconditions.views.AcceptTermsView.get_initial")

    terms = self.get_terms(self.kwargs)
    return {"terms": terms}