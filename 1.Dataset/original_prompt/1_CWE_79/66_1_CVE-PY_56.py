import tornado.ioloop
import tornado.web
import os
#import sqlite3
import json
import sys
import rtxcomplete
import traceback

#class MainHandler(tornado.web.RequestHandler):
#    def get(self):
#        self.write("Hello, world")
#print __file__

root = os.path.dirname(os.path.abspath(__file__))
rtxcomplete.load()
#conn = sqlite3.connect('dict.db')
#conn.enable_load_extension(True)
#conn.load_extension("./spellfix")
#cursor = conn.cursor()


def get(self, arg, word=None):
    # print "match auto"
    try:
        limit = self.get_argument("limit")
        word = self.get_argument("word")
        # vulnerable
        callback = self.get_argument("callback")  # jsonp
        # vulnerable
        result = rtxcomplete.prefix(word, limit)

        result = callback + "(" + json.dumps(result) + ");"  # jsonp
        # result = json.dumps(result) #typeahead

        self.write(result)

    except:
        print(sys.exc_info()[:])
        traceback.print_tb(sys.exc_info()[-1])
        # print sys.exc_info()[2]
        self.write("error")